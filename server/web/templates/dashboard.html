<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LabLink Dashboard</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <!-- Chart.js for live data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Navigation Header -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <h1>LabLink</h1>
                <span class="navbar-subtitle">Dashboard</span>
            </div>

            <div class="navbar-actions">
                <a href="/profiles.html" class="btn btn-secondary btn-sm">Profiles</a>
                <a href="/settings.html" class="btn btn-secondary btn-sm">Settings</a>

                <button class="btn btn-icon" id="darkModeToggle" title="Toggle dark mode">
                    <span class="icon-sun">‚òÄÔ∏è</span>
                    <span class="icon-moon" style="display: none;">üåô</span>
                </button>

                <div class="user-menu">
                    <span class="user-name" id="userName">User</span>
                    <button class="btn btn-secondary btn-sm" id="logoutButton">Sign Out</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Alert for notifications -->
        <div class="alert alert-info" id="alert" style="display: none;"></div>

        <!-- Overview Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Equipment</div>
                <div class="stat-value" id="totalEquipment">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Connected</div>
                <div class="stat-value stat-success" id="connectedEquipment">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Disconnected</div>
                <div class="stat-value stat-warning" id="disconnectedEquipment">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Error</div>
                <div class="stat-value stat-error" id="errorEquipment">0</div>
            </div>
        </div>

        <!-- Equipment List -->
        <div class="section">
            <div class="section-header">
                <h2>Equipment</h2>
                <button class="btn btn-primary btn-sm" id="refreshButton">
                    <span class="btn-text">Refresh</span>
                    <span class="btn-spinner" style="display: none;"><span class="spinner"></span></span>
                </button>
            </div>

            <div id="equipmentList" class="equipment-grid">
                <!-- Equipment cards will be dynamically inserted here -->
            </div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <p>No equipment found</p>
                <p class="text-muted">Add equipment to get started</p>
            </div>
        </div>

        <!-- Live Charts Section -->
        <div class="section" id="chartsSection" style="display: none;">
            <div class="section-header">
                <h2>Live Data</h2>
                <div class="chart-controls">
                    <select id="chartEquipmentSelect" class="chart-select">
                        <option value="">Select equipment...</option>
                    </select>
                    <button class="btn btn-secondary btn-sm" id="toggleChartsButton">Hide Charts</button>
                </div>
            </div>

            <div class="charts-grid">
                <!-- Voltage Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Voltage (V)</h3>
                    <canvas id="voltageChart"></canvas>
                </div>

                <!-- Current Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Current (A)</h3>
                    <canvas id="currentChart"></canvas>
                </div>

                <!-- Temperature Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Temperature (¬∞C)</h3>
                    <canvas id="temperatureChart"></canvas>
                </div>

                <!-- Power Chart -->
                <div class="chart-container">
                    <h3 class="chart-title">Power (W)</h3>
                    <canvas id="powerChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Alarms & Notifications Section -->
        <div class="section" id="alarmsSection">
            <div class="section-header">
                <h2>Alarms & Notifications</h2>
                <button class="btn btn-secondary btn-sm" id="refreshAlarmsButton">
                    <span class="btn-text">Refresh</span>
                    <span class="btn-spinner" style="display: none;"><span class="spinner"></span></span>
                </button>
            </div>

            <div id="alarmsList" class="alarms-list">
                <!-- Alarm items will be dynamically inserted here -->
            </div>

            <div id="noAlarmsState" class="empty-state" style="display: none;">
                <p>No active alarms</p>
                <p class="text-muted">All systems operating normally</p>
            </div>
        </div>

        <!-- Discovery Section -->
        <div class="section">
            <div class="section-header">
                <h2>Discovery</h2>
                <button class="btn btn-secondary btn-sm" id="startDiscoveryButton">
                    <span class="btn-text">Start Discovery</span>
                    <span class="btn-spinner" style="display: none;"><span class="spinner"></span></span>
                </button>
            </div>

            <div id="discoveryStatus" class="discovery-status" style="display: none;">
                <p>Scanning for equipment...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="discoveryProgress"></div>
                </div>
            </div>

            <div id="discoveredDevices" class="discovered-devices" style="display: none;">
                <!-- Discovered devices will be listed here -->
            </div>
        </div>
    </div>

    <!-- Equipment Control Modal (for simple commands) -->
    <div id="controlModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Equipment Control</h3>
                <button class="btn btn-icon btn-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalAlert" class="alert alert-info" style="display: none;"></div>

                <div class="form-group">
                    <label for="commandInput">Command</label>
                    <input type="text" id="commandInput" placeholder="Enter command (e.g., *IDN?)">
                </div>

                <div id="commandResponse" class="command-response" style="display: none;">
                    <label>Response:</label>
                    <pre id="responseText"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelCommand">Cancel</button>
                <button class="btn btn-primary" id="sendCommand">
                    <span class="btn-text">Send</span>
                    <span class="btn-spinner" style="display: none;"><span class="spinner"></span></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>
